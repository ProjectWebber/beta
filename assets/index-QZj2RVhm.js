import{r as ge,i as he,f as A,c as Z,a as u,p as pe,v as ve,b as ye,d as xe,e as we,g as Ce,n as ee,h as be,s as Fe,k as Se,m as N,l as je,o as G,q as R,t as W,w as te,u as ze,j as c,x as v,M as x,N as B,y as Ne,P as ke,z as Ae,G as Ee,A as se,B as y,F as Ie}from"./index-ykasaoJ0.js";import{s as re,Q as Oe,B as oe}from"./index-R1xNtVFL.js";import{S as _,C as _e,B as L,g as S,a as w}from"./ConfirmationModal-BuGYQDSM.js";import"./InputText-G6Nit0QG.js";const E=new WeakMap;let I;const ne=(e,t,s)=>(r,o)=>o&&o[0]?o[0][e+"Size"]:he(r)&&"getBBox"in r?r.getBBox()[t]:r[s],Be=ne("inline","width","offsetWidth"),Le=ne("block","height","offsetHeight");function Me({target:e,borderBoxSize:t}){E.get(e)?.forEach(s=>{s(e,{get width(){return Be(e,t)},get height(){return Le(e,t)}})})}function Pe(e){e.forEach(Me)}function De(){typeof ResizeObserver>"u"||(I=new ResizeObserver(Pe))}function Re(e,t){I||De();const s=ge(e);return s.forEach(r=>{let o=E.get(r);o||(o=new Set,E.set(r,o)),o.add(t),I?.observe(r)}),()=>{s.forEach(r=>{const o=E.get(r);o?.delete(t),o?.size||I?.unobserve(r)})}}const O=new Set;let C;function Te(){C=()=>{const e={get width(){return window.innerWidth},get height(){return window.innerHeight}};O.forEach(t=>t(e))},window.addEventListener("resize",C)}function We(e){return O.add(e),C||Te(),()=>{O.delete(e),!O.size&&typeof C=="function"&&(window.removeEventListener("resize",C),C=void 0)}}function He(e,t){return typeof e=="function"?We(e):Re(e,t)}function ae(e,t){let s;const r=()=>{const{currentTime:o}=t,a=(o===null?0:o.value)/100;s!==a&&e(a),s=a};return A.preUpdate(r,!0),()=>Z(r)}function Ue(e,t,s){u.useInsertionEffect(()=>e.on(t,s),[e,t,s])}const $e=50,V=()=>({current:0,offset:[],progress:0,scrollLength:0,targetOffset:0,targetLength:0,containerLength:0,velocity:0}),Ge=()=>({time:0,x:V(),y:V()}),Ve={x:{length:"Width",position:"Left"},y:{length:"Height",position:"Top"}};function J(e,t,s,r){const o=s[t],{length:n,position:a}=Ve[t],i=o.current,d=s.time;o.current=e[`scroll${a}`],o.scrollLength=e[`scroll${n}`]-e[`client${n}`],o.offset.length=0,o.offset[0]=0,o.offset[1]=o.scrollLength,o.progress=pe(0,o.scrollLength,o.current);const l=r-d;o.velocity=l>$e?0:ve(o.current-i,l)}function Je(e,t,s){J(e,"x",t,s),J(e,"y",t,s),t.time=s}function Qe(e,t){const s={x:0,y:0};let r=e;for(;r&&r!==t;)if(ye(r))s.x+=r.offsetLeft,s.y+=r.offsetTop,r=r.offsetParent;else if(r.tagName==="svg"){const o=r.getBoundingClientRect();r=r.parentElement;const n=r.getBoundingClientRect();s.x+=o.left-n.left,s.y+=o.top-n.top}else if(r instanceof SVGGraphicsElement){const{x:o,y:n}=r.getBBox();s.x+=o,s.y+=n;let a=null,i=r.parentNode;for(;!a;)i.tagName==="svg"&&(a=i),i=r.parentNode;r=a}else break;return s}const T={start:0,center:.5,end:1};function Q(e,t,s=0){let r=0;if(e in T&&(e=T[e]),typeof e=="string"){const o=parseFloat(e);e.endsWith("px")?r=o:e.endsWith("%")?e=o/100:e.endsWith("vw")?r=o/100*document.documentElement.clientWidth:e.endsWith("vh")?r=o/100*document.documentElement.clientHeight:e=o}return typeof e=="number"&&(r=t*e),s+r}const Ke=[0,0];function Xe(e,t,s,r){let o=Array.isArray(e)?e:Ke,n=0,a=0;return typeof e=="number"?o=[e,e]:typeof e=="string"&&(e=e.trim(),e.includes(" ")?o=e.split(" "):o=[e,T[e]?e:"0"]),n=Q(o[0],s,r),a=Q(o[1],t),n-a}const qe={All:[[0,0],[1,1]]},Ye={x:0,y:0};function Ze(e){return"getBBox"in e&&e.tagName!=="svg"?e.getBBox():{width:e.clientWidth,height:e.clientHeight}}function et(e,t,s){const{offset:r=qe.All}=s,{target:o=e,axis:n="y"}=s,a=n==="y"?"height":"width",i=o!==e?Qe(o,e):Ye,d=o===e?{width:e.scrollWidth,height:e.scrollHeight}:Ze(o),l={width:e.clientWidth,height:e.clientHeight};t[n].offset.length=0;let f=!t[n].interpolate;const m=r.length;for(let g=0;g<m;g++){const p=Xe(r[g],l[a],d[a],i[n]);!f&&p!==t[n].interpolatorOffsets[g]&&(f=!0),t[n].offset[g]=p}f&&(t[n].interpolate=xe(t[n].offset,we(r),{clamp:!1}),t[n].interpolatorOffsets=[...t[n].offset]),t[n].progress=Ce(0,1,t[n].interpolate(t[n].current))}function tt(e,t=e,s){if(s.x.targetOffset=0,s.y.targetOffset=0,t!==e){let r=t;for(;r&&r!==e;)s.x.targetOffset+=r.offsetLeft,s.y.targetOffset+=r.offsetTop,r=r.offsetParent}s.x.targetLength=t===e?t.scrollWidth:t.clientWidth,s.y.targetLength=t===e?t.scrollHeight:t.clientHeight,s.x.containerLength=e.clientWidth,s.y.containerLength=e.clientHeight}function st(e,t,s,r={}){return{measure:o=>{tt(e,r.target,s),Je(e,s,o),(r.offset||r.target)&&et(e,s,r)},notify:()=>t(s)}}const F=new WeakMap,K=new WeakMap,D=new WeakMap,X=e=>e===document.scrollingElement?window:e;function ce(e,{container:t=document.scrollingElement,...s}={}){if(!t)return ee;let r=D.get(t);r||(r=new Set,D.set(t,r));const o=Ge(),n=st(t,e,o,s);if(r.add(n),!F.has(t)){const i=()=>{for(const m of r)m.measure(be.timestamp);A.preUpdate(d)},d=()=>{for(const m of r)m.notify()},l=()=>A.read(i);F.set(t,l);const f=X(t);window.addEventListener("resize",l,{passive:!0}),t!==document.documentElement&&K.set(t,He(t,l)),f.addEventListener("scroll",l,{passive:!0}),l()}const a=F.get(t);return A.read(a,!1,!0),()=>{Z(a);const i=D.get(t);if(!i||(i.delete(n),i.size))return;const d=F.get(t);F.delete(t),d&&(X(t).removeEventListener("scroll",d),K.get(t)?.(),window.removeEventListener("resize",d))}}const q=new Map;function rt(e){const t={value:0},s=ce(r=>{t.value=r[e.axis].progress*100},e);return{currentTime:t,cancel:s}}function ie({source:e,container:t,...s}){const{axis:r}=s;e&&(t=e);const o=q.get(t)??new Map;q.set(t,o);const n=s.target??"self",a=o.get(n)??{},i=r+(s.offset??[]).join(",");return a[i]||(a[i]=!s.target&&Fe()?new ScrollTimeline({source:t,axis:r}):rt({container:t,...s})),a[i]}function ot(e,t){const s=ie(t);return e.attachTimeline({timeline:t.target?void 0:s,observe:r=>(r.pause(),ae(o=>{r.time=r.iterationDuration*o},s))})}function nt(e){return e.length===2}function at(e,t){return nt(e)?ce(s=>{e(s[t.axis].progress,s)},t):ae(e,ie(t))}function ct(e,{axis:t="y",container:s=document.scrollingElement,...r}={}){if(!s)return ee;const o={axis:t,container:s,...r};return typeof e=="function"?at(e,o):ot(e,o)}const it=()=>({scrollX:N(0),scrollY:N(0),scrollXProgress:N(0),scrollYProgress:N(0)}),k=e=>e?!e.current:!1;function lt({container:e,target:t,...s}={}){const r=Se(it),o=u.useRef(null),n=u.useRef(!1),a=u.useCallback(()=>(o.current=ct((i,{x:d,y:l})=>{r.scrollX.set(d.current),r.scrollXProgress.set(d.progress),r.scrollY.set(l.current),r.scrollYProgress.set(l.progress)},{...s,container:e?.current||void 0,target:t?.current||void 0}),()=>{o.current?.()}),[e,t,JSON.stringify(s.offset)]);return je(()=>{if(n.current=!1,k(e)||k(t)){n.current=!0;return}else return a()},[a]),u.useEffect(()=>{if(n.current)return G(!k(e)),G(!k(t)),a()},[a]),r}const dt=(e,t)=>{try{return re.getFileView(e,t)}catch(s){throw console.error("Error getting the file url in getFileUrl():",s),s}},ut=async e=>{try{return(await re.listFiles(e,[Oe.limit(100)])).files}catch(t){throw console.error("Error fetching files in fetchFiles():",t),t}};function ft(e){return e.map(s=>{const r=dt(oe,s.$id);return{...s,url:r}})}const mt=()=>{const[e,t]=u.useState({files:null,isFetchingFiles:!0});return u.useEffect(()=>{(async()=>{const r=await ut(oe);t({files:r,isFetchingFiles:!1})})()},[]),{filesState:e}},gt=e=>{let t=[];if(!e)return t;const s=e.includes("$");return s&&(t=e.split("$").map(r=>R(r.replaceAll("_"," ")))),s||(t=[R(e.replaceAll("_"," "))]),t},ht=e=>{const[t,s,r]=e.split("-");if(!t||!s)throw new Error(`Formato inválido: ${e}`);const[o,n]=t.split("$"),a=o.split("_"),i=Number(a[a.length-1]),d=a[0],l=gt(s);return{assetName:o,assetNumber:i,category:d,filters:l,bodyBelonging:r||void 0}},pt=e=>{const t=e.name.split(".")[0];let s={};const r={id:e.$id,url:e.url,fileName:t,assetName:t};return t!=="prop_vazio"&&(s=ht(t)),{...r,...s}},vt=e=>e.map(s=>pt(s)),yt=(e,t)=>{const s={};return t.forEach(r=>{const o=e.filter(n=>n.bodyBelonging===r.assetName);s[r.assetName]=o}),s},xt=(e,t,s)=>{const r={};return Object.keys(e).forEach(n=>{r[n]={},t.forEach(a=>{if(a!=="corpos"){const i=e[n].filter(d=>d.category===a);r[n][a]=[s,...i]}})}),r},wt=e=>e.filter(s=>s.category==="corpos"),Ct=e=>e.filter(s=>s.fileName==="prop_vazio")[0],j=["corpos","olhos","sobrancelhas","narizes","camisas","bocas","cabelos"],bt=(e,t)=>{const s=[...new Set(t.flatMap(o=>o.filters||[]))],r=Object.fromEntries(Object.entries(e).map(([o,n])=>{const a=Object.fromEntries(Object.entries(n).map(([i,d])=>{const l=[...new Set(d.flatMap(f=>f.filters||[]))];return[i,l]}));return[o,a]}));return{bodyFilters:s,assetFilters:r}};function Ft(e){const t=ft(e),s=vt(t),r=wt(s),o=Ct(s),n=yt(s,r),a=xt(n,j,o),{bodyFilters:i,assetFilters:d}=bt(a,r);return{organizedFiles:{bodies:r,emptyProp:o,categories:j,assets:a,onlyBodyOrganizedFiles:n,bodyFilters:i,assetFilters:d},dataOrganizedFiles:s}}const St=e=>{const t={};return j.forEach(s=>{const r=e.filter(a=>a.category===s),o=[];r.forEach(a=>{if(a.filters!==void 0){const i=a.filters.filter(d=>d!=="");o.push(...i)}});const n=new Set(o);t[s]=[...n]}),t},b=W((e,t)=>({files:null,isLoading:!0,setFiles:(s,r)=>{JSON.stringify(t().files)!==JSON.stringify(s)&&e({files:s,isLoading:r})}})),z=W((e,t)=>({filters:void 0,checkedFilters:[],setAllFilters:s=>{e(()=>({filters:s}))},addCheckedFilter:s=>e(r=>({checkedFilters:[...r.checkedFilters,s]})),removeCheckedFilter:s=>{const o=t().checkedFilters.filter(n=>n!==s);e(()=>({checkedFilters:o}))},resetCheckedFilters:()=>e(()=>({checkedFilters:[]}))}));function jt(){const{files:e,isFetchingFiles:t}=mt().filesState,s=b(n=>n.setFiles),r=z(n=>n.setAllFilters),o=u.useCallback(()=>{if(!t&&e!==null&&e.length>0){const{organizedFiles:n,dataOrganizedFiles:a}=Ft(e),i=St(a);r(i),s(n,!1)}},[e,t,r,s]);u.useEffect(()=>{o()},[o])}const h=W((e,t)=>({selectedCategory:"corpos",defaultAssets:{corpos:"corpos_m_1",sobrancelhas:"prop_vazio",olhos:"prop_vazio",narizes:"prop_vazio",bocas:"prop_vazio",camisas:"prop_vazio",cabelos:"prop_vazio"},selectedAssets:{corpos:"corpos_m_1",sobrancelhas:"prop_vazio",olhos:"prop_vazio",narizes:"prop_vazio",bocas:"prop_vazio",camisas:"prop_vazio",cabelos:"prop_vazio"},setSelectedCategory:s=>e({selectedCategory:s}),setCategoryAsset:s=>{t().defaultAssets;const r=t().selectedCategory;if(s)switch(r){case"corpos":e(o=>{const n={...o.defaultAssets,corpos:s};return localStorage.setItem("previousCharacter",JSON.stringify(n)),{selectedAssets:n}});break;default:e(o=>{const n={...o.selectedAssets,[r]:s};return localStorage.setItem("previousCharacter",JSON.stringify(n)),{selectedAssets:n}});break}},replaceSelectedAssets:s=>{localStorage.setItem("previousCharacter",JSON.stringify(s)),e(()=>({selectedAssets:s}))},resetSelectedAssets:()=>{const s=t().defaultAssets,r=t().selectedAssets.corpos,o={...s,corpos:r};e(()=>({selectedAssets:o})),localStorage.setItem("previousCharacter",JSON.stringify(o))}}));function zt(){const e=u.useCallback((s,r)=>localStorage.setItem(s,JSON.stringify(r)),[]),t=u.useCallback(s=>{const r=localStorage.getItem(s);if(!(r===void 0||r==null))return JSON.parse(r)},[]);return{setData:e,getData:t}}const Nt=()=>{const e=zt().getData,t=h(r=>r.replaceSelectedAssets);return{setPreviousCharacter:u.useCallback(()=>{const r=e("previousCharacter");r!=null&&t(r)},[e,t])}},kt=()=>{const e=_(i=>i.savedCharacters),t=h(i=>i.replaceSelectedAssets),{setPreviousCharacter:s}=Nt(),{characterID:r}=te(),o=ze(),n=u.useCallback(()=>{const i=Object.entries(e).find(d=>d[0]===r);if(!i){o("/customizador");return}return i[1]},[e,r,o]),a=u.useCallback(()=>{const i=n();if(!i){s();return}t(i.selectedAssets)},[n,s,t]);u.useEffect(()=>{a()},[a])},At=()=>{const e=h(s=>s.selectedCategory),t=z(s=>s.resetCheckedFilters);u.useEffect(()=>t(),[e])},Et=()=>{jt(),At(),kt()};function M(e){const[t,s]=u.useState("content-fade-right"),r=u.useMemo(()=>t,[t]),{scrollXProgress:o}=lt({container:e});return Ue(o,"change",n=>{e.current!==null&&e.current.scrollWidth>e.current.clientWidth&&(n<=.1?s("content-fade-right"):n>=.9?s("content-fade-left"):s("content-fade-x"))}),{fade:r}}const It=`max-w-fit text-nowrap flex items-center justify-center rounded-3xl  px-4 py-1 transition-all

    bg-background-dark hover:bg-background has-checked:bg-background-light
    
    border border-muted border-t-accent has-checked:border-accent

    text-foreground-muted has-checked:text-foreground
    `,Ot=u.memo(({id:e,children:t,value:s,className:r})=>{const o=z(i=>i.addCheckedFilter),n=z(i=>i.removeCheckedFilter),a=u.useCallback(i=>{if(i){o(s);return}n(s)},[o,n,s]);return c.jsxs("label",{className:v(It,r),htmlFor:e,children:[c.jsx("input",{type:"checkbox",className:"hidden",id:e,value:s,onChange:i=>a(i.target.checked)}),t]})}),_t=()=>{const e=u.useRef(null),{fade:t}=M(e),s=h(a=>a.selectedCategory),r=h(a=>a.selectedAssets.corpos),o=b(a=>s==="corpos"?a.files?.bodyFilters:a.files?.assetFilters[r][s]),n=()=>o?o.length===0?c.jsx("span",{children:"Categoria sem filtros."}):o.map(a=>c.jsx(Ot,{id:`filtro-${a}`,value:a,children:a},`filtro-${a}`)):c.jsx("span",{className:"text-md text-foreground",children:"Carregando filtros..."});return c.jsx("section",{ref:e,className:v("mb-4 flex h-fit w-full gap-2 overflow-x-scroll overflow-y-hidden px-2 pb-1",t),children:n()})},le=()=>{const e=x(o=>o.addConfirmationModal),t=x(o=>o.removeConfirmationModal),s=B(o=>o.addNotification);return{onReset:o=>{e(c.jsx(_e,{onReset:()=>{o(),t();const n=S();s(c.jsx(L,{variant:"success",componentKey:n,children:"Personagem redefinido com sucesso!"},n))}}))}}},Bt="relative flex aspect-square! h-[48%] w-fit cursor-pointer items-center justify-center overflow-hidden rounded-[15%] transition-all bg-linear-to-b border",Lt="bg-background-light opacity-90 brightness-70 border-muted border-t-accent transition-all",Mt="hover:opacity-95! hover:brightness-90!",Pt="drop-shadow-md drop-shadow-black/20 opacity-100 brightness-100 dark:brightness-110",de=({id:e,name:t,checked:s,onChange:r,className:o,children:n})=>c.jsxs("label",{htmlFor:e,className:v("flex",o),children:[c.jsx("input",{type:"radio",name:t,id:e,checked:s,onChange:r,className:"hidden"}),n]}),Y=Ne({base:"absolute h-full w-full !border-transparent transition-all opacity-0 z-2",variants:{corpo:{corpos_f_1:"",corpos_m_1:""},category:{bocas:"",cabelos:"",camisas:"top-0 left-0 scale-[1]",corpos:"top-0 left-0 scale-[1]",narizes:"",olhos:"",sobrancelhas:""}},compoundVariants:[{corpo:"corpos_m_1",category:"sobrancelhas",class:"left-[35%] top-[93%] scale-[410%]"},{corpo:"corpos_m_1",category:"olhos",class:"left-[38%] top-[91%] scale-[470%]"},{corpo:"corpos_m_1",category:"narizes",class:"left-[46%] top-[74%] scale-[500%]"},{corpo:"corpos_m_1",category:"bocas",class:"left-[52%] top-[44%] scale-[620%]"},{corpo:"corpos_m_1",category:"cabelos",class:"top-[25%] left-[5%] scale-[150%]"},{corpo:"corpos_f_1",category:"sobrancelhas",class:"left-[37%] top-[80%] scale-[410%]"},{corpo:"corpos_f_1",category:"olhos",class:"left-[42%] top-[78%] scale-[470%]"},{corpo:"corpos_f_1",category:"narizes",class:"left-[52%] top-[70%] scale-[500%]"},{corpo:"corpos_f_1",category:"bocas",class:"left-[71%] top-[39%] scale-[730%]"},{corpo:"corpos_f_1",category:"cabelos",class:"top-[16%] left-[3%] scale-[140%]"}],defaultVariants:{corpo:"corpos_m_1",category:"corpos"}}),Dt=({className:e,corpo:t,category:s,assetSrc:r,assetAlt:o,bodySrc:n,bodyAlt:a})=>{const i=u.useRef(null),d=u.useRef(null),l=f=>f.currentTarget.complete&&f.currentTarget.classList.remove("opacity-0");return c.jsxs(c.Fragment,{children:[c.jsx("img",{className:v(Y({corpo:t,category:s}),e),src:r,alt:o,ref:d,crossOrigin:"anonymous",draggable:!1,loading:"lazy",decoding:"async",onLoad:l}),s!=="corpos"&&c.jsx("img",{className:v(Y({corpo:t,category:s}),e,"z-1"),src:n,alt:a,ref:i,crossOrigin:"anonymous",draggable:!1,loading:"lazy",decoding:"async",onLoad:l})]})},Rt=u.memo(({id:e,assetData:t,bodyData:s,onChange:r})=>{const o=h(a=>a.selectedCategory),n=h(a=>a.selectedAssets[o]===t.assetName);return c.jsx("div",{className:v(Bt,Lt,n&&Pt,!n&&Mt),children:c.jsx(de,{id:`selection-panel-asset-grid-${e}`,name:"selection-panel-asset-grid",className:"relative flex aspect-square h-full items-center justify-center transition-all",checked:n,onChange:r,children:t.assetName==="prop_vazio"?c.jsx(ke,{size:"2.1rem",className:"text-foreground"}):c.jsx(Dt,{assetSrc:t.url,assetAlt:`Imagem do asset ${t.assetName}`,bodySrc:s.url,bodyAlt:`Imagem do corpo selecionado na grid de assets ${s.assetName}`,category:o,corpo:t.bodyBelonging})})})}),Tt=u.forwardRef((e,t)=>c.jsxs("span",{className:"text-foreground flex flex-1 items-center justify-center gap-1",ref:t,children:[c.jsx(Ae,{})," Nenhum asset encontrado."]}));function Wt(e){return Ee({attr:{viewBox:"0 0 1024 1024"},child:[{tag:"path",attr:{d:"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 0 0-94.3-139.9 437.71 437.71 0 0 0-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z"},child:[]}]})(e)}const Ht=u.forwardRef((e,t)=>c.jsxs("span",{className:"text-foreground flex flex-1 items-center justify-center gap-1",ref:t,children:[c.jsx(Wt,{className:"animate-spin"})," Carregando..."]})),Ut=({children:e})=>{const t=h(n=>n.selectedCategory),s=u.useRef(null),{fade:r}=M(s),o=v("flex h-full w-full flex-1 flex-col flex-wrap place-content-start overflow-x-scroll overflow-y-hidden px-2 gap-[3%] md:gap-1 pb-1 mb-2",r);return c.jsx("section",{className:o,ref:s,children:e},t+"-gridData-Section")},$t=()=>{const e=b(l=>l.isLoading),t=h(l=>l.selectedCategory),s=h(l=>l.selectedAssets.corpos),r=b(l=>{if(!l.files)return null;const f=l.files.bodies.find(m=>m.assetName===s);return f||null}),o=b(l=>l.files===null?null:t==="corpos"?l.files.bodies:l.files.assets[s][t]),n=h(l=>l.setCategoryAsset),a=z(l=>l.checkedFilters),{onReset:i}=le();return{GridContent:u.useMemo(()=>{if(e||!r||!o)return c.jsx(Ht,{});if(!e&&o.length===0)return c.jsx(Tt,{});const f=o.map(m=>{if(m.assetName==="prop_vazio"||a.length===0||a.every(p=>m.filters?.includes(p)))return m}).filter(m=>m!==void 0).map(m=>{const g=()=>{if(t!=="corpos"){n(m.assetName);return}i(()=>n(m.assetName))};return c.jsx(Rt,{id:m.id+"-grid-item",assetData:m,bodyData:r,onChange:g},m.assetName+"-grid-item")});return c.jsx(Ut,{children:f},t+"-gridData-Section")},[i,n,e,t,r,o,a])}},Gt=()=>{const{GridContent:e}=$t();return c.jsx(c.Fragment,{children:e})},Vt=({category:e,id:t,children:s})=>{const r=h(n=>n.selectedCategory===e),o=h(n=>n.setSelectedCategory);return c.jsx(se.div,{initial:{opacity:0,y:15},animate:{opacity:1,y:0},whileHover:{scale:1.05},whileTap:{scale:.95},children:c.jsx(de,{id:t,className:v("font-specialelite cursor-pointer text-xl transition-all",r&&"text-foreground",!r&&"text-foreground-muted opacity-70 hover:opacity-100"),checked:r,name:"selection-panel-tabs",onChange:()=>o(e),children:s})})},Jt=()=>{const e=u.useRef(null),{fade:t}=M(e),s=j.map(r=>c.jsx(Vt,{id:`tab-customizer-${r}`,category:r,children:R(r)},`tab-customizer-${r}`));return c.jsx("section",{ref:e,className:v("mb-2 flex h-fit w-full gap-5 overflow-x-scroll overflow-y-hidden px-3 pb-1",t),children:s},"categories-tabs-container")},Qt=u.memo(()=>c.jsxs("section",{className:"flex h-[54%] md:max-h-85 xl:max-h-95 md:max-w-85 lg:max-w-110 xl:max-w-150 w-full flex-1 flex-col",children:[c.jsx(Jt,{}),c.jsx(Gt,{}),c.jsx(_t,{})]})),Kt=({category:e,...t})=>{const s=h(n=>n.selectedAssets[e]),r=h(n=>n.selectedAssets.corpos),o=b(n=>{if(n.files)return e==="corpos"?n.files.bodies.find(a=>a.assetName===s):n.files.assets[r][e].find(a=>a.assetName===s)});return c.jsx(c.Fragment,{children:o&&c.jsx(se.img,{initial:{opacity:0},animate:{opacity:1,transition:{duration:.15}},exit:{opacity:0,transition:{duration:.1}},src:o.url,alt:`Preview do asset ${o.assetName}`,crossOrigin:"anonymous",draggable:!1,loading:"lazy",decoding:"async",className:"text-foreground absolute z-3 h-full opacity-0 transition-all md:h-auto md:w-full",onLoad:n=>{n.currentTarget.classList.remove("opacity-0")},...t},`preview-${o.assetName}-${o.id}`)})},Xt=u.memo(()=>{const e=u.useCallback(()=>j.map(t=>c.jsx(Kt,{category:t},`preview-${t}`)),[]);return c.jsx("div",{className:"content-fade-bottom relative aspect-square h-[46%] md:h-auto md:w-full md:max-w-140 2xl:max-w-170",id:"preview-container",children:e()},"preview-container")}),qt=()=>{const e=h(s=>s.resetSelectedAssets),{onReset:t}=le();return c.jsx(y,{variant:"primary",size:"sm",onClick:()=>t(e),children:"Resetar"})},H=()=>{const e=(d,l)=>{const f=document.createElement("canvas");return f.width=d,f.height=l,f},t=(d,l,f)=>{d.clearRect(0,0,l,f)},s=(d,l,f,m)=>{d.complete&&l.drawImage(d,0,0,f,m)},r=(d,l,f)=>{document.querySelectorAll("#preview-container img").forEach(g=>{s(g,d,l,f)})},o=d=>{const l=d.toDataURL("image/png"),f=document.createElement("a");f.download="portrait.png",f.href=l,f.click()},n=(d,l,f)=>d.toDataURL(l,f);return{drawAndDownload:()=>{const d=e(900,900),l=d.getContext("2d");l&&(t(l,d.width,d.height),r(l,d.width,d.height),o(d))},getLowQualityImageUrl:()=>{const d=e(500,500),l=d.getContext("2d");return l?(t(l,d.width,d.height),r(l,d.width,d.height),n(d,"image/webp",.6)):void 0}}},Yt=()=>{const e=B(r=>r.addNotification),{drawAndDownload:t}=H(),s=()=>{t();const r=S();e(c.jsx(L,{variant:"success",componentKey:r,children:"Imagem baixada com sucesso!"},r))};return c.jsx(y,{variant:"primary",onClick:s,size:"sm",children:"Baixar Imagem"})},ue=()=>new Intl.DateTimeFormat("pt-br",{timeZone:"America/Sao_Paulo",year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"}).format(new Date).toString(),Zt=({onSaveSubmit:e})=>{const[t,s]=u.useState(),r=x(o=>o.removeModal);return c.jsxs(w.Container,{children:[c.jsx(w.Content,{modalTitle:c.jsx(c.Fragment,{children:"Qual o nome do seu personagem?"}),modalDescription:c.jsx(c.Fragment,{children:'Ao salvar, o personagem estará disponivel em "Meus Personagens".'}),children:c.jsx("div",{className:"mt-2",children:c.jsx(w.Input,{labelText:"Nome",inputTips:"Use pelo menos uma letra.",onChange:o=>{s(o.target.value)}})})}),c.jsxs(w.ActionsContainer,{children:[c.jsx(y,{size:"sm",variant:"default",onClick:r,children:"Voltar"}),c.jsx(y,{size:"sm",variant:"success",onClick:()=>e(t),children:"Salvar"})]})]})},fe=()=>{const e=B(i=>i.addNotification),t=x(i=>i.addModal),s=x(i=>i.removeModal),r=h(i=>i.selectedAssets),o=_(i=>i.saveCharacter),{getLowQualityImageUrl:n}=H();return{handleSave:u.useCallback(()=>{const i=d=>{const l=n();if(!d||!l)return;const f={name:d,saveDate:ue(),lowQualityImageUrl:l,selectedAssets:r};o(S(),f);const m=S();e(c.jsx(L,{variant:"success",componentKey:m,children:"Personagem salvo com sucesso!"},m)),s()};t(c.jsx(Zt,{onSaveSubmit:i}))},[t,e,n,s,o,r])}},es=({onSaveAsNew:e,onOverwrite:t})=>{const s=x(r=>r.removeModal);return c.jsxs(w.Container,{children:[c.jsx(w.Content,{modalTitle:"Como deseja salvar o personagem?",modalDescription:"Escolha se deseja criar um novo personagem, substituir o personagem atual ou cancelar as alterações."}),c.jsxs(w.ActionsContainer,{children:[c.jsx(y,{size:"sm",variant:"default",onClick:()=>s(),children:"Voltar"}),c.jsx(y,{size:"sm",variant:"success",onClick:e,children:"Salvar novo"}),c.jsx(y,{size:"sm",variant:"error",onClick:t,children:"Substituir"})]})]})},ts=()=>{const{getLowQualityImageUrl:e}=H(),{characterID:t}=te(),s=x(g=>g.addModal),r=x(g=>g.removeModal),o=_(g=>g.replaceCharacter),n=B(g=>g.addNotification),a=h(g=>g.selectedAssets),i=_(g=>g.savedCharacters),{handleSave:d}=fe(),l=u.useMemo(()=>!!(t&&t.length===15),[t]),f=u.useCallback(g=>{const p=Object.entries(i).find(([P])=>P===g);if(p)return p},[i]);return{isEditing:l,handleSaveOverwrite:()=>{if(l){console.log("Overwrite");const g=t;if(!g)return;const p=f(g);if(!p)return;const P=()=>{const U=e();if(!U)return;const me={name:p[1].name,saveDate:p[1].saveDate,editDate:ue(),lowQualityImageUrl:U,selectedAssets:a};o(g,me);const $=S();n(c.jsx(L,{variant:"success",componentKey:$,children:"Personagem salvo foi substituido com sucesso!"},$)),r()};s(c.jsx(es,{onOverwrite:P,onSaveAsNew:d}))}}}},ss=()=>{const{isEditing:e,handleSaveOverwrite:t}=ts(),{handleSave:s}=fe(),r=()=>{if(e){t();return}s()};return c.jsx(y,{variant:"primary",onClick:r,size:"sm",children:"Salvar Personagem"})},rs=u.memo(()=>{const e=u.useRef(null),{fade:t}=M(e);return c.jsxs("footer",{className:v("mb-2 flex h-fit w-full gap-2 overflow-x-auto overflow-y-hidden px-2 pb-2",t),ref:e,children:[c.jsx(qt,{}),c.jsx(Yt,{}),c.jsx(ss,{})]})}),is=()=>(Et(),c.jsxs(Ie,{className:"px-screen-responsive flex h-full w-full flex-1 flex-col sm:justify-between",children:[c.jsxs("section",{className:"flex h-full flex-1 flex-col-reverse items-center md:w-full md:flex-row md:justify-between",children:[c.jsx(Qt,{}),c.jsx(Xt,{})]}),c.jsx(rs,{})]}));export{is as default};
